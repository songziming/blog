#!/usr/bin/env ruby

layout '/**/*', :erb

compile '/notes/**/*.md' do
    filter :pandoc, from: 'markdown', to: 'html5', args: ['mathjax']
    layout '/note.*'
    match  = item.identifier.to_s.match(/^\/notes\/(.*)\.md$/)
    number = match[1].split('/').map { |s| s.match(/^(\d+)-(.*)$/)[1] }
    write "/#{number.join('/')}_#{item[:permalink]}.html"
end

compile '/notes/**/asset/**/*' do
    match  = item.identifier.to_s.match(/^\/notes\/(.*)\/asset\/(.*)$/)
    number = match[1].split('/').map { |s| s.match(/^(\d+)-(.*)$/)[1] }
    write "/#{number.join('/')}/asset/#{match[2]}"
end

compile '/*.html' do
    filter :erb
    layout '/base.*'
    write item.identifier.to_s
end

compile '/**/*' do
    write item.identifier.to_s
end
