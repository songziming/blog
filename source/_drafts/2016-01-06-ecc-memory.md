---
title: ECC 内存
---

一些比较高端的内存条带有 ECC 功能，所谓 ECC 表示 Error Correcting Code。内存存储数据有一定出错的可能，ECC 是一种非常聪明的自动纠错机制。

## 比特误码

我们知道，电子计算机中的数据用二进制表示，最基本的存储单元是比特，取值只能是 0 或者 1。内存是计算机的存储设备，其中保存的就是这种二进制数据。在数据存储的过程中，可能会发生比特误码，也就是二进制数发生翻转，原来的 0 变成了 1，原来的 1 变成了 0。虽然现在的制造工艺非常先进，发生比特误码的概率已经很低，但毕竟还有可能存在，而且在计算机中一旦发生比特误码，造成的后果是十分严重的。程序的正确运行依赖计算机产生正确的结果，如果执行 1 加 1 算出的结果不是 2，系统自然会崩溃。一些服务器需要长时间的运行，如果能降低比特误码发生的概率，对提升服务的在线时间（up-time）非常有用。


这样的技术已经出现，叫做 ECC。它使用的是概率和信息论的知识，能够实现对比特误码的检测、恢复，而且额外的负担非常小。

一般来说，让一个不靠谱的东西更靠谱，通常的做法是增加冗余。例如在航天器上，由于有宇宙射线的影响，CPU 发生错误的概率要高很多，于是人们创造出了一种投票机制。一台计算机上，使用三个完全相同的 CPU 进行运算，执行完全相同的操作，并对三个 CPU 的结果进行比较，如果三者的结果一样，那么很好，可以继续；如果某个 CPU 不幸算错了，投票结果 2:1，就按照其他两个正常的 CPU 的结果将这个异常的 CPU 恢复到正常状态。总之，增加冗余可以提高靠谱程度。

对于内存来说，采用类似的方法也可以，同一份信息保存三份，使用的时候比较一下。但是这样做过于浪费，性能也会受影响。

ECC 的思想则聪明一些，它增加的冗余比特非常少。这里需要说明一个事实，比特误码是一种小概率事件，对于一个字节来说，发生一个二进制位翻转是小概率的，两个二进制发生翻转则更是小概率的事件。在所有发生比特反转的样本中，绝大多数的情况是只有一个比特位发生了反转。

这是非常重要的结论，ECC 正是利用这个规律进行自动纠错。但是在介绍 ECC 的原理之前，首先要介绍汉明距离的概念。

## 汉明距离

汉明（hamming）距离也成作汉明编码，描述的是两个相同长度的二进制数之间的距离。汉明距离定义为，两个相同长度的二进制数中，取值不同的二进制位的个数。

汉明距离对比特误码有什么作用？之前说过，发生比特误码最有可能的是只有一个二进制位发生改变，如果计算一个突变之后的数据和原始数据的汉明距离，改变一个二进制位则汉明距离为 1，同时改变两个比特位，则汉明距离为 2。

## 冗余

现在从数值空间的角度思考问题。一个字节有 8 个二进制位，总共能表示 $2^8$ 种信息。如果我们向这个字节加入一些冗余的二进制位，例如增加 3 个二进制位，这样总共 11 个二进制位，可以表示 $2^11$ 种数据。但是，这 $2^11$ 种数据中，只有 $2^8$ 种是有意义的，剩余 $2^11-2^8$ 种数据都是不合法的。于是，我们把加入了冗余的取值分成了两部分，合法部分和不合法部分。

正常情况下，保存的数据只能是合法的，如果出现了不合法数据，那么就说明发生了比特误码。关键是，如何才能在发生比特误码时，让误码之后的表示都是不合法的数据，这样一旦发生误码，就能立即检测到。
